<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>焖肉面 - puzzle hunt工具集</title>
		<style>
			.capsule{
				background-color: #9eddff;
				width: 100%;
				height: 20px;
				border-radius: 10px;
				text-align: center;
				margin:2px;
				cursor: pointer;
				margin: 5px;
			}
			.flag-shape {
                margin: 10px;
                width: 0;
                height: 0;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-bottom: 30px solid #000000;
			}
			.transparent {
				opacity: .1;
			}
			.capsule:hover{
				font-weight: bold;
				-webkit-transform: translateX(-3px);
				transform: translateX(-3px);
				transition: .5s ease;
			}
			.content-area {
				height: fit-content;
			}
			.container {
				width: 50%;
			}
			.content-area textarea {
				background-color: #f8f8f8;
  				font-size: 16px;
				margin: 10px;
			}
			.help-content {
				font-size: 12px;
    			color: #adabab;
				background-color: "unset";
			}
			#word-search-content {
				width: 40%;
				height: 400px;
			}
			.word-content {
				width: 80%;
				display: flex;
				flex-wrap: wrap;
				word-break: break-word;
			}
			#word-find-similarity-hint {
				margin-top: 30px;
			}
			.word-content > div{
				margin: 5px
			}
			.word-content > b{
				flex-basis: 100%;
				font-size: 20px;
			}
			#footer, h1 {
				margin: 40px;
				display: flex;
				justify-content: space-around;
			}
			.face-container {
				width: fit-content;
				display: flex;
				width: 100%;
				justify-content: space-around;
			}
			#expand {
				width: fit-content;
				margin: 10px;
			}
			.face {
				height: 200px;
				width: 200px;

			}
			.cube-block {
				background-color: gray;
				vertical-align: bottom;
				border: 1px solid;
			}
			#rubik-cube{
				border: 5px solid;
			}
			#piano {
				display: flex;
			}
			.pianoWhiteKey {
				width: 25px;
				height: 120px;
				border: 1px solid;
				margin-right: -1px;
				display: flex;
				flex-direction: column;
				justify-content: flex-end;
			}
			.pianoBlackArea{
				position: absolute;
				display: flex;
				margin-left: 15px;
			}
			.pianoBlackKey {
				width: 20px;
				height: 80px;
				display: flex;
				flex-direction: column;
				justify-content: flex-end;
				border: 1px solid;
				background-color: black;
				color: white;
			}
			.blind-dot {
				border-radius: 50%;
				width: 30px;
				height: 30px;
				border: 1px solid;
				margin: 10px 2px 2px 10px;
			}
			#blind-letter, #flag-letter{
				font-size: 20px;
				margin-left: 40px;
				margin-top: 20px;
			}
			.map-unit {
				width: 25px;
			}
			.map-unit input{
				width: 22px;
				background-color: #80808036;
			}
			.map-unit div {
				margin-left: 4px;
			}
 		</style>
		<link rel="stylesheet" href="./static/nonogram.css">
		<link rel="stylesheet" href="./static/bootstrap.min.css">
	</head>
	<body>
		<h1>焖肉面- puzzle hunt工具集</h1>
		<div class="container">
			<div id="word-container">
				<div id="word-capsule" class="capsule" data-expend=true>puzzle 字典(正则匹配、anagram、通配符、编辑距离)</div>
				<div id="word-main" class="content-area">
					<textarea id="one-word-content" class="form-control" placeholder="请输入要查询的单词"></textarea>
					<div id="method-select">
						<select onchange="changeMethod()" id="find-method">
							<option value ="findByWildcard">通配符</option>
							<option value ="findByRegularExpression">正则</option>
							<option value ="contains">包含</option>
							<option value ="findSimilarity">寻找相似单词(编辑距离)</option>
							<option value ="findByCode">DIY写程序查找</option>
						</select>
					</div>
					<pre id="help-content" class="help-content"></pre>
					<button id="find-words">solve</button>
					<div>以下为可能结果:</div>
					<div id="word-list-count"></div>
					<div id="words-list"></div>
				</div>
			</div>
			<div id="substitution-container">
				<div id="substitution-capsule" class="capsule" data-expend=true>单表替换</div>
				<div id="substitution-main" class="content-area" style="display: none;">
					<form role="form">
						<div class="form-group">
							<div>单表暴力</div>
							<textarea id="content" class="form-control" rows="20" placeholder="请输入单表密文"></textarea>
							<div>
								<button id="substitution-solver-btn" type="button">单表暴力</button>
							</div>
						</div>
					</form>
					<div>以下为可能结果:</div>
					<div id="substitution-answer"></div>
				</div>
			</div>
			<div id="nonogram-container">
				<div id="nonogram-capsule" class="capsule" data-expend=true>nonogram</div>
				<div id="nonogram-main" class="content-area" style="display: none;">
					<form role="form">
						<div class="form-group">
							<label for="name">行</label>
							<input id="row" value="5" onchange="ModifiedCb()"/>
							<label for="name">列</label>
							<input id="column" value="5" onchange="ModifiedCb()"/>
						</div>
					</form>
					<div id="playground">
						<div id="upper-bar"></div>
						<div id="bottom">
							<div id="left-bar"></div>
							<div id="board"></div>
						</div>
					</div>
					<button onclick="solve()">solve</button>
				</div>
			</div>
			<div id="word-search-container">
				<div id="word-search-capsule" class="capsule" data-expend=true>Word Search</div>
				<div id="word-search-main" class="content-area" style="display: none;">
					<div class="help-content">Word Search是一个找词游戏，给出一个n*m的字母方阵，要求在横竖斜的方向上找到英语单词</div>
					<div class="help-content">在下面文本框内填入要word search的字母方阵，例如</div>
					<div class="help-content">abc</div>
					<div class="help-content">ddf</div>
					<div class="help-content">ghi</div>
					<div>
						<textarea id="word-search-content" class="form-control" placeholder="请输出字母方阵,用空行隔开"></textarea>
						<button onclick="wordSearch()">Solver</button>
					</div>
					<div id="word-search-ansers" style="display: flex">
						<div id="word-search-ansers-list"></div>
						<div id="word-search-ansers-position" style="margin-left: 40px"></div>
					</div>
				</div>
			</div>
			<div id="rubik-cube-container">
				<div id="rubik-cube-capsule" class="capsule" data-expend=true>魔方</div>
				<div id="rubik-cube-main" class="content-area" style="display: none;">
					<div class="help-content">请拖动魔方观看所有面:</div>
					<canvas id="rubik-cube" height="300px" width="300px"></canvas>
					<button onclick="resetRubicCube()">重置魔方</button>
					<div>
						<div>顺时针</div>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' F');window.rubicCube.front(1)">前面(F)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' U');window.rubicCube.up(1)">顶面(U)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' B');window.rubicCube.back(-1)">背面(B)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' D');window.rubicCube.bottom(-1)">底面(D)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' L');window.rubicCube.left(1)">左边(L)</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' R');window.rubicCube.right(-1)">右面(R)</button>
					</div>
					<div>
						<div>逆时针</div>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' F\'');window.rubicCube.front(-1)">前面(F')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' U\'');window.rubicCube.up(-1)">顶面(U')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' B\'');window.rubicCube.back(1)">背面(B')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' D\'');window.rubicCube.bottom(1)">底面(D')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' L\'');window.rubicCube.left(-1)">左边(L')</button>
						<button onclick="$('#rubic-formular').html($('#rubic-formular').html() + ' R\'');window.rubicCube.right(1)">右面(R')</button>
					</div>
					<br/>
					<b id="rubic-formular">公式 :</b>
					<br/>
					<div class="help-content">在下面魔方展开图中可用鼠标绘制任意图案颜色(注:画笔颜色既可以是颜色英文，例如red, blue, orange, 也可是#开头的RGB,例如#FFABCD)</div>
					<label>画笔颜色</label><input id="penColor" value="black"/>
					<label>画笔粗细</label><input id="penWidth" value="3"/>
					<div id="expand"></div>
				</div>
			</div>
			<div id="music-container">
				<div id="music-capsule" class="capsule" data-expend=true>音乐</div>
				<div id="music-main" class="content-area" style="display: none;">
					<div id="piano">
						<div onclick="playSound(130.81, 2000)" class="pianoWhiteKey">C3</div>
						<div onclick="playSound(146.83, 2000)" class="pianoWhiteKey">D3</div>
						<div onclick="playSound(164.81, 2000)" class="pianoWhiteKey">E3</div>
						<div onclick="playSound(174.61, 2000)" class="pianoWhiteKey">F3</div>
						<div onclick="playSound(196.00, 2000)" class="pianoWhiteKey">G3</div>
						<div onclick="playSound(220, 2000)" class="pianoWhiteKey">A3</div>
						<div onclick="playSound(246.94, 2000)" class="pianoWhiteKey">B3</div>
						<div onclick="playSound(261.63, 2000)" class="pianoWhiteKey">C4</div>
						<div onclick="playSound(293.66, 2000)" class="pianoWhiteKey">D4</div>
						<div onclick="playSound(329.63, 2000)" class="pianoWhiteKey">E4</div>
						<div onclick="playSound(349.23, 2000)" class="pianoWhiteKey">F4</div>
						<div onclick="playSound(392.00, 2000)" class="pianoWhiteKey">G4</div>
						<div onclick="playSound(440, 2000)" class="pianoWhiteKey">A4</div>
						<div onclick="playSound(493.88, 2000)" class="pianoWhiteKey">B4</div>
						<div class="pianoBlackArea">
							<div class="pianoBlackKey">C#</div>
							<div class="pianoBlackKey">D#</div>
						</div>
					</div>
				</div>
			</div>
			<div id="blind-container">
				<div id="blind-capsule" class="capsule" data-expend=true>盲文&旗语</div>
				<div id="blind-main" class="content-area" style="display: none;">
					<div>盲文:</div>
					<div id="demo-blind-letter" style="margin-right: 5px;">
						<div style="display: flex;">
							<div>
								<div class="blind-dot" data-index=0 ></div>
								<div class="blind-dot" data-index=1 ></div>
								<div class="blind-dot" data-index=2 ></div>
							</div>
							<div>
								<div class="blind-dot" data-index=3 ></div>
								<div class="blind-dot" data-index=4 ></div>
								<div class="blind-dot" data-index=5 ></div>
							</div>
						</div>
						<div id="blind-letter"></div>
					</div>
					<button onclick="confirmBlind()" style="margin: 20px;">确认</button>
					<div id="history-blind-area" style="display: flex;"></div>
					<div >旗语:</div>
					<div id="demo-flag">
						<div style="display: flex;">
							<div class="flag-shape " style="transform: rotate(-45deg);" data-index=0></div>
							<div class="flag-shape" data-index=1></div>
							<div class="flag-shape transparent" style="transform: rotate(45deg);" data-index=2></div>
						</div>
						<div style="display: flex;">
							<div class="flag-shape transparent" style="transform: rotate(-90deg);" data-index=3></div>
							<div style="width: 40px; height: 50px;" ></div>
							<div class="flag-shape transparent" style="transform: rotate(90deg);" data-index=4></div>
						</div>
						<div style="display: flex;">
							<div class="flag-shape transparent" style="transform: rotate(-135deg);" data-index=5></div>
							<div class="flag-shape transparent" style="transform: rotate(180deg);" data-index=6></div>
							<div class="flag-shape transparent" style="transform: rotate(135deg);" data-index=7></div>
						</div>
						<div id="flag-letter"></div>
					</div>
					<button onclick="confirmFlag()" style="margin: 20px;">确认</button>
					<div id="history-flag-area" style="display: flex;"></div>
				</div>
			</div>
			<div id="cipher-container">
				<div id="cipher-capsule" class="capsule" data-expend=true>古典密码</div>
				<div id="cipher-main" class="content-area" style="display: none;">
					<div id="cipher-tools">
						<button id="caeser-brute-force" style="margin: 20px;">暴力凯撒</button>
						<button id="QWE" style="margin: 20px;">QWE</button>
						<div id="general-substitute-cipher">
							<select onchange="changeSubstitutionMethod()" id="substitution-cipher-method">
								<option value ="QWECipher">QWE加密</option>
								<option value ="QWECipher">QWE解密</option>
								<option value ="QWECipher">Atbash</option>
							</select>
							<div id="substitute-table" style="display: flex;"></div>
							<button onclick="solveGeneralSubstitution()">解码</button>
						</div>
						<input id="autoDecode" type="checkbox" onclick="autoCheckClick()"/> 自动暴力
					</div>
					<textarea id="cipher-code-textarea" class="form-control" rows="20" placeholder="请输入密文" oninput="onTypePlainCode()"></textarea>
					<div id="plain-code-area"></div>
				</div>
			</div>
			<div id="drop-quotes-container">
				<div id="drop-quotes-capsule" class="capsule" data-expend=true>Drop Quotes</div>
				<div id="drop-quotes-main" class="content-area" style="display: none;">
					<form role="form">
						<div class="form-group">
							<label for="name">r</label>
							<input id="drop-quotes-row" value="2" onchange="dropQuoteModifiedCb()"/>
							<label for="name">c</label>
							<input id="drop-quotes-column" value="7" onchange="dropQuoteModifiedCb()"/>
							<input id="blackbox-seprete" type="checkbox"  checked ="checked"> 黑格子用来做单词分割
						</div>
					</form>
					<div id="drop-quotes-playground">
						<div id="drop-quotes-upper-bar"></div>
						<div id="drop-quotes-bottom">
							<div id="dq-board"></div>
						</div>
					</div>
					<div id="drop-quote-answer"></div>
					<button onclick="dropQuotesSolve()">solve</button>
				</div>
			</div>
		</div>
		<div id="footer"> power by -- philippica (Contact me: philippicapyj@gmail.com)</div>

		<script src="./static/jquery.min.js"></script>
		<script>
			// substitution
			$(".capsule").click((e) => {
				const target = e.target;
				const content = $(target.parentElement.lastElementChild);
				if(content.is(":visible")) {
					content.hide("fast", "linear");
				} else {
					content.show("fast", "linear");
				}
			});


			let rubicCubeMaterias;

			$("#rubik-cube-capsule").click((e) => {
				if(!window.rubicCube) {
					const materias = initExpand();
					rubicCubeMaterias = materias
					const rubikCanvas = document.getElementById('rubik-cube'),
					rubikCtx = rubikCanvas.getContext('2d');
					window.rubicCube = new Solver.RubikCubeStage(rubikCtx, rubikCanvas.width, rubikCanvas.height, rubicCubeMaterias);
				}
			});

			$("#substitution-solver-btn").click(function(){
				var content = $("#content").val();
				console.info(content);
				plaintext = new Solver.SubstitutionSolver().substituteSolver(content)
				$("#substitution-answer").empty();
				if(plaintext.length === 0) {

				}
				for(let i = 0; i < Math.min(plaintext.length, 100); i++) {
					$("#substitution-answer").append(`<div><b>${plaintext[i]}</b></div>`);
				}
			});

			// nono
			let columnArea = [];
			let rowArea = [];

			const setTile = (x, y, color) => {
				console.info(x, y, color);
				if(color === 2) {
					$(`#cell-${x}-${y}`).css("background-color", "white")
				}
				if(color === 1) {
					$(`#cell-${x}-${y}`).css("background-color", "black")
				}
			}

			const solve = () => {
				let columnSum = 0;
				for(let line of columnArea) {
					for(let number of line) {
						columnSum += number;
					}
				}

				let rowSum = 0;
				for(let line of rowArea) {
					for(let number of line) {
						rowSum += number;
					}
				}

				if(rowSum != columnSum) {
					alert(`左半部分的和为${rowSum}, 右半部分的和为${columnSum}， 两者不相等，检查一下`);
					return;
				}
				plaintext = new Solver.Nonogram().nonogramSolver(columnArea, rowArea, setTile)
			}

			const changeInput = (e) => {
				const value = parseInt(e.target.innerText);
				if(e.data && value > 0) {
					const data = e.target.dataset;
					console.info(data);
					const index = parseInt(data.idx);
					const column = parseInt(data.col);
					const row = parseInt(data.row);
					if(data.type === "col" && (index === columnArea[column].length)) {
						columnArea[column].push(value);
						console.info(columnArea);
						$(`#col-${data.col}`).prepend(`<div id="col-cell-${data.col}-${index+1}" data-type="col" data-col=${data.col} data-idx=${index+1} contenteditable="true" oninput="changeInput(event)" class="col-input">0</div>`);
					}
					else if(data.type === "row" && (index === rowArea[row].length)) {
						rowArea[row].push(value);
						$(`#row-${data.row}`).prepend(`<div id="row-cell-${data.row}-${index+1}" data-type="row" data-row=${data.row} data-idx=${index+1} contenteditable="true" oninput="changeInput(event)" class="row-input">0</div>`);
						console.info(rowArea);
					} else if(data.type === "row") {
						rowArea[row][index] = value;
					} else {
						columnArea[column][index] = value;
					}
				} else {
					const data = e.target.dataset;
					const index = parseInt(data.idx);
					const column = parseInt(data.col);
					const row = parseInt(data.row);
					if(data.type === "row") {
						while(rowArea[row].length > index) {
							rowArea[row].pop();
							$(`#row-${data.row}`).children().eq(0).remove();
						}
					} else {
						while(columnArea[column].length > index) {
							columnArea[column].pop();
							$(`#col-${data.col}`).children().eq(0).remove();
						}
					}
				}
			}

			const ModifiedCb = () => {
				let col = parseInt($("#column").val());
				let row = parseInt($("#row").val());
				columnArea = [];
				rowArea = [];
				for(let i = 0; i < col; i++) {
					columnArea.push([]);
				}
				for(let i = 0; i < row; i++) {
					rowArea.push([]);
				}
				$("#upper-bar").empty();
				$("#left-bar").empty();
				$("#board").empty();

				for(let i = 0; i < col; i++) {
					$("#upper-bar").append(`<div id="col-${i}" class="col-container"></div>`);
					$(`#col-${i}`).append(`<div id="col-cell-${i}-0" data-type="col" data-col=${i} data-idx=0 contenteditable="true" oninput="changeInput(event)" class="col-input">0</div>`);
				}
				for(let i = 0; i < row; i++) {
					$("#left-bar").append(`<div id="row-${i}" class="row-container"></div>`);
					$(`#row-${i}`).append(`<div id="row-cell-${i}-0" contenteditable="true" data-type="row" data-row=${i} data-idx=0 oninput="changeInput(event)" class="row-input">0</div>`);
					$("#board").append(`<div id="row-${i}" class="row-board"></div>`);
					// $(`#board #row-${i}`).append(`<div contenteditable="true" class="row-input"></div>`);
					for(let j = 0; j < col; j++) {
						$(`#board #row-${i}`).append(`<div id="cell-${i}-${j}" class="cell"></div>`);
					}
				}
			}
			ModifiedCb();

			// one word
			const solver = new Solver.OneWord();
			const oneWordHelpContent = {
				"findByWildcard": "当前是通配符模式 - 你可以使用#表示一个字母或者*表示多个字母 例如 bo##ke*r 可以匹配到bookkeeper",
				"findByRegularExpression": "当前是正则表达式模式 - 如果你熟悉正则表达式，那它将会是一个非常强大的工具 例如^[abcd][ef].*[aeiou]$ 能够搜到第一个字母为abcd中一个，第二个字母为ef中一个，并且以元音结尾的所有单词",
				"contains": "当前是包含模式 - 能够搜出所有至少包含这些字母的单词，例如abbcc会找到所有至少包含一个a两个b和两个c的单词",
				"findSimilarity": "当前是相似度模式-给出单词找到与它相想的单词，两个词相似度即编辑距离，如果能通过一次添加一个字母，替换一个字母或删除一个字母能从一个单词变成另一个单词，那它们的相似度为1",
				"findByCode": "最灵活的找词方式，通过自己编写js代码，实现一个接受一个字符串作为参数的check函数来寻找单词\n函数同时会传入一个tool的参数，包含很多有用函数，当前包括:\n\tisWord(str: string) :bool : 判断传入字符串是否为英语单词\n\tanagram(str: string, letters: string) :bool : 判断传入字符串是否为letters参数中的字符排列组成"
			};
			let method = "findByWildcard";
			$("#help-content").text(oneWordHelpContent[method]);
			const changeMethod = () => {
				const methodStr = $("#find-method").val()
				method = methodStr;
				$('#word-find-similarity-hint').remove();
				$('#similarityRegex').remove();
				$("#similarityDegree").remove();
				$("#one-word-content").height(60);
				if(method === "findSimilarity") {
					$("#method-select").append("<input id='similarityDegree' placeholder='相似度' value='1'/>");
					$("#method-select").append("<div id='word-find-similarity-hint'>在结果中用正则查找:</div><input id='similarityRegex' placeholder='正则表达式(不填则输出所有结果)' />");
				} else if(method === 'contains') {
					$("#method-select").append("<div id='word-find-similarity-hint'>在结果中用正则查找:</div><input id='similarityRegex' placeholder='正则表达式(不填则输出所有结果)' />");
				} else if(method === "findByCode") {
					$("#one-word-content").val('function check(str, tools) {\n\tif(str[0]!=str[str.length-1])return null; // 如果首字母和尾字母不相等，不选这个单词\n\tif(str.length > 7 || str.length < 5)return null; // 如果单词长度大于7或者小于2，不选这个单词\n\tif(/^a.*b$/.test(str))return null;// 如果满足正则^a.*b$ 不选这个单词\n\tif(tools.anagram(str.substr(2,3), "guo") === false)return null; // 如果从第3个字符起往后3个字母不是由abc组成的，不选这个单词\n\tif(tools.isWord(str.substr(2,5)) === true){ // 如果单词第3个字符（因为下标从0开始)往后5个字母是一个英语单词\n\t\treturn str + " " + str.substr(2,5); //输出该词，并把第三个到第5个字母的字串放后面\n\t}\n}');
					$("#one-word-content").height(400);
				}
				$("#help-content").text(oneWordHelpContent[method]);
			}
			$("#find-words").click(async function(){
				let content = $("#one-word-content").val();
				let answer;
				$("#words-list").empty();
				if(method !== "contains") {
					for(let i = 20; i >= 1; i--) {
					 	$("#words-list").append(`<div id="len-${i}" style="display: none;" class="word-content"><b style="display: block">长度为${i}:</b></div>`);
					}
				} else {
					for(let i = 1; i <= 20; i++) {
					 	$("#words-list").append(`<div id="len-${i}" style="display: none;" class="word-content"><b style="display: block">长度为${i}:</b></div>`);
					}
				}
				let count = 0;
				const findWord = async (wordLength, word) => {
					function sleep(ms) {
						return new Promise(resolve => setTimeout(resolve, ms));
					}
					const target = $(`#words-list #len-${wordLength}`);
					if(!target.is(":visible")) {
						target.show("fast", "linear");
					}
					target.append(`<div>${word}</div>`);
					count++;
					$('#word-list-count').html(`共${count}个`);
					if(count % 1000 === 0) {
						await sleep(1);
					}
				}
				const solverFunc = new Solver.OneWord()[method].bind(solver);
				if(method === "findSimilarity") {
					const regex = $('#similarityRegex').val();
					let regularExpression;
					if(regex && regex !== '') {
						regularExpression = eval(`/${regex}/`);
					}
					findSimilarity = async (wordLength, word) => {
						if(regularExpression && !regularExpression.test(word)) {
							return;
						}
						await findWord(wordLength, word);
					}
					const similarityDegree = parseInt($("#similarityDegree").val());
					answer = await solverFunc(content, similarityDegree, findSimilarity)
				} else if(method === 'contains') {
					const regex = $('#similarityRegex').val();
					let regularExpression;
					if(regex && regex !== '') {
						regularExpression = eval(`/${regex}/`);
					}
					findSimilarity = async (wordLength, word) => {
						if(regularExpression && !regularExpression.test(word)) {
							return;
						}
						await findWord(wordLength, word);
					}
					answer = await solverFunc(content, findSimilarity)
				} else {
					answer = await solverFunc(content, findWord)
				}
			});

			// word search
			wordSearch = () => {
				var content = $("#word-search-content").val();
				console.info(content);
				const mat = new Solver.WordSearch().buildMatrix(content);
				const answers = new Solver.WordSearch().wordSearch(mat);
				answers.sort((a, b) => b.word.length - a.word.length);
				for(let answer of answers) {
					let dirFirst = "";
					let dirSecond = "";
					if(answer.dy === 1) {
						dirFirst = "右";
					} else if(answer.dy === -1) {
						dirFirst = "左";
					}
					if(answer.dx === 1) {
						dirSecond = "下";
					} else if(answer.dx === -1) {
						dirSecond = "上";
					}
					$("#word-search-ansers-list").append(`<div>${answer.word}</div>`);
					$("#word-search-ansers-position").append(
						`<div>出现在第${answer.x+1}行，第${answer.y+1}列，向${dirFirst}${dirSecond}方向</div>`
					);
				}
			}

			// rubik cube
			initExpand = () => {
				const blocks = [];
				for(let i = 0; i < 4; i++) {
					$('#expand').append(`<div id="expand-${i}" class="face-container"></div>`);
				}
				$('#expand-0').append(`<div id="face-${0}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${1}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${2}" class="face"></div>`);
				$('#expand-1').append(`<div id="face-${3}" class="face"></div>`);
				$('#expand-2').append(`<div id="face-${4}" class="face"></div>`);
				$('#expand-3').append(`<div id="face-${5}" class="face"></div>`);
				const width = Math.floor($('#face-1').width() / 3-4);
				const height = Math.floor($('#face-1').height() / 3-4);
				const blockNum = 9;
				const colors = ["white", "green", "red", "blue", "yellow", "orange"]
				for(let i = 0; i < 6; i++) {
					for(let j = 0; j < blockNum; j++) {
						$(`#face-${i}`).append(`<canvas id="block-${i*blockNum+j}" width="${width}px" height="${height}px" class="cube-block"></canvas>`);
						let canvas = document.getElementById(`block-${i*blockNum+j}`);
						let ctx=canvas.getContext("2d");
						ctx.fillStyle=colors[i];
						ctx.fillRect(0,0,width,height);
						const index = i*blockNum+j;
						ctx.fillStyle="black";
						ctx.font="20px Georgia";
						ctx.fillText (index.toString(), 20,20);
						blocks.push(canvas);
					}
				}
				return blocks;
			}
			resetRubicCube = () => {
				$('#rubic-formular').html('公式: ')
				const rubikCanvas = document.getElementById('rubik-cube'),
				rubikCtx = rubikCanvas.getContext('2d');
				window.rubicCube = new Solver.RubikCubeStage(rubikCtx, rubikCanvas.width, rubikCanvas.height, rubicCubeMaterias);
			}

			//music
			const playSound = (frequency, timeInMillisecont) => {
				const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				// create Oscillator node
				const oscillator = audioCtx.createOscillator();
				oscillator.type = 'sine';
				oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime); // value in hertz
				oscillator.connect(audioCtx.destination);
				oscillator.start();
				setTimeout(()=>{
					oscillator.stop();
				}, timeInMillisecont);
			}

			// blind
			const currentBlindState = [0,0,0,0,0,0];
			const braille = [];
			braille[1] = 'a';braille[3] = 'b';
			braille[9] = 'c';braille[25] = 'd';
			braille[17] = 'e';braille[11] = 'f';
			braille[27] = 'g';braille[19] = 'h';
			braille[10] = 'i';braille[26] = 'j';
			braille[5] = 'k';braille[7] = 'l';
			braille[13] = 'm';braille[29] = 'n';
			braille[21] = 'o';braille[15] = 'p';
			braille[31] = 'q';braille[23] = 'r';
			braille[14] = 's';braille[30] = 't';
			braille[37] = 'u';braille[39] = 'v';
			braille[58] = 'w';braille[45] = 'x';
			braille[61] = 'y';braille[53] = 'z';


			$('.blind-dot').on("click",function(e)
			{
				const idx = parseInt(e.target.dataset.index);
				if(currentBlindState[idx]) {
					e.target.style.backgroundColor=""
				} else {
					e.target.style.backgroundColor="black"
				}
				currentBlindState[idx] ^= 1;

				let code = 0;
				for(let i = 0; i < 6; i++) {
					code += currentBlindState[i] * (1<<i);
				}
				if(braille[code]) {
					$("#blind-letter").text(braille[code]);
				} else {
					$("#blind-letter").text("Unknown");
				}
			});

			const confirmBlind = () => {
				$("#history-blind-area").append($("#demo-blind-letter").clone());
			}
			const confirmFlag = () => {
				$("#history-flag-area").append($("#demo-flag").clone());
			}

			const flagState = [0, 1];
			const flagMap = [];
			flagMap[51] = 'a';flagMap[33] = 'b';
			flagMap[6] = 'c';flagMap[15] = 'd';
			flagMap[24] = 'e';flagMap[42] = 'f';
			flagMap[61] = 'g';flagMap[32] = 'h';
			flagMap[5] = 'i';flagMap[13] = 'j';
			flagMap[14] = 'k';flagMap[23] = 'l';
			flagMap[41] = 'm';flagMap[52] = 'n';
			flagMap[3] = 'o';flagMap[12] = 'p';
			flagMap[21] = 'q';flagMap[31] = 'r';
			flagMap[34] = 's';flagMap[1] = 't';
			flagMap[2] = 'u';flagMap[16] = 'v';
			flagMap[22] = 'w';flagMap[25] = 'x';
			flagMap[4] = 'y';flagMap[43] = 'z';

			$('.flag-shape').on("click",function(e)
			{
				const idx = parseInt(e.target.dataset.index);
				if(flagState[0] === idx || flagState[1] === idx)return;
				e.target.style.opacity=1;
				$(`.flag-shape[data-index=${flagState[0]}]`)[0].style.opacity=0.1;
				flagState[0] = flagState[1];
				flagState[1] = idx;

				const code = Math.min(flagState[0], flagState[1])*9 + Math.max(flagState[0], flagState[1]);
				console.info(code);
				if(flagMap[code]) {
					$("#flag-letter").text(flagMap[code]);
				} else {
					$("#flag-letter").text("Unknown");
				}
			});

			// classic Code

			const caeser = (str, offset) => {
				let ans = "";
				for(let ch of str) {
					let base;
					if(ch.charCodeAt() >= 65 && ch.charCodeAt() <= 90) {
						base = 65;
					} else if (ch.charCodeAt() >= 97 && ch.charCodeAt() <= 122) {
						base = 97;
					} else {
						ans += ch;
					}
					ans += String.fromCharCode((ch.charCodeAt() - base + offset) % 26 + base);
				}
				return ans;
			}

			const caeserProcess = () => {
				const cipherCode = $("#cipher-code-textarea").val();
				$('#plain-code-area').empty();
				for(let i = 1; i <= 25; i++) {
					const pt = caeser(cipherCode, i)
					$('#plain-code-area').append(`<div style="display:flex;"><div>凯撒${i}： </div><div>${pt}</div></div>`);
				}
			}

			
			const substitutionTable = [
				['q','w','e','r','t','y','u','i','o','p','a','s','d','f','g','h','j','k','l','z','x','c','v','b','n','m'],
				['k','x','v','m','c','n','o','p','h','q','r','s','z','y','i','j','a','d','l','e','g','w','b','u','f','t'],
				['z','y','x','w','v','u','t','s','r','q','p','o','n','m','l','k','j','i','h','g','f','e','d','c','b','a'],
			];

			const makeMap = (mapList) => {
				const ret = {};
				for(let i = 0; i < 26; i++) {
					ret[String.fromCharCode(i+97)] = mapList[i];
				}
				return ret;
			} 


			$('#caeser-brute-force').on("click",function(e)
			{
				caeserProcess();
			});
			
			const useMethod = (index) => {
				$("#substitute-table").empty();
				for(let i = 0; i < 26; i++) {
					const letter = String.fromCharCode(97 + i);
					$("#substitute-table").append(`<div class="map-unit"><div>${letter}</div><input id="cipher-text" data-pt="${letter}" value="${substitutionTable[index][i]}"/></div>`);
				}
			}

			const changeSubstitutionMethod = () => {
				const methodIndex = $("#substitution-cipher-method")[0].selectedIndex;
				useMethod(methodIndex);

			}

			const onTypePlainCode = (e) => {
				const isAutoDecode = $('#autoDecode').get(0).checked;
				if(!isAutoDecode)return;
				caeserProcess();
				let pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[0]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>QWE加密： </div><div>${pt}</div></div>`);

				pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[1]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>QWE解密： </div><div>${pt}</div></div>`);

				pt = substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[2]));
				$('#plain-code-area').append(`<div style="display:flex;"><div>Atbash： </div><div>${pt}</div></div>`);
			}

			$('#substitution-cipher-method').ready(() => {
				useMethod(0);
			});

			const substituteCipher = (str, mapT) => {
				let mappingTable = mapT
				if(!mapT) {
					mappingTable = $.map($(".map-unit #cipher-text"), (element, i) => 
						{
							const pt = element.dataset.pt;
							const ret = {};
							ret[pt] = element.value;
							return ret;
						}
					).reduce((pre, cur) => {
						return Object.assign(pre, cur);
					});
				}

				let ans = "";
				for(let ch of str) {
					if(mappingTable[ch]) {
						ans += mappingTable[ch];
					} else if(mappingTable[toLowerCase(ch)]) {
						ans += mappingTable[toLowerCase(ch)];
					} else {
						ans += ch;
					}
				}
				return ans;
			}

			const solveGeneralSubstitution = () => {
				const cipherCode = $("#cipher-code-textarea").val();
				$('#plain-code-area').empty();
				const pt = substituteCipher(cipherCode);
				$('#plain-code-area').append(`<div style="display:flex;"><div>结果: </div><div>${pt}</div></div>`);
			}

			const autoCheckClick = (e) => {
				const isAutoDecode = $('#autoDecode').get(0).checked;
				if(isAutoDecode) {
					$('#cipher-code-textarea')[0].style.borderColor = 'red';
					caeserProcess();
					substituteCipher($("#cipher-code-textarea").val(), makeMap(substitutionTable[0]));

				} else {
					$('#cipher-code-textarea')[0].style.borderColor = '';
				}
			}
		
		// drop quotes
		let dropQuotesColumnArea = [];
			let dropQuotesrowArea = [];
			const dropQuotesSolve = () => {
				const isBlackBoxSeprete = $('#blackbox-seprete').get(0).checked;
				let col = parseInt($("#drop-quotes-column").val());
				let row = parseInt($("#drop-quotes-row").val());
				const grid = [];
				for(let i = 0; i < row; i++) {
					const line = [];
					for(let j = 0; j < col; j++) {
						if($(`#dq-cell-${i}-${j}`)[0].style.backgroundColor === "white") {
							line.push(true);
						} else {
							line.push(false);
						}
					}
					grid.push(line);
				}
				$("#drop-quote-answer").empty();
				const findAnswerCb = (str) => {
					$("#drop-quote-answer").append(`<div>${str}</div>`);
				}
				const answers = new Solver.DropQuote(grid, dropQuotesColumnArea, col, row).calculate(findAnswerCb, isBlackBoxSeprete);
				console.info(answers);
			}

			const dropQuotesChangeInput = (e) => {
				const value = e.target.innerText;
				if(e.data && value) {
					const data = e.target.dataset;
					console.info(data);
					const index = parseInt(data.idx);
					const column = parseInt(data.col);
					const row = parseInt(data.row);
					if(data.type === "col" && (index === dropQuotesColumnArea[column].length)) {
						dropQuotesColumnArea[column].push(value);
						console.info(dropQuotesColumnArea);
						$(`#dq-col-${data.col}`).prepend(`<div id="dq-col-cell-${data.col}-${index+1}" data-type="col" data-col=${data.col} data-idx=${index+1} contenteditable="true" oninput="dropQuotesChangeInput(event)" class="col-input">0</div>`);
					} else {
						dropQuotesColumnArea[column][index] = value;
					}
				}
			}

			const dropQuoteModifiedCb = () => {
				let col = parseInt($("#drop-quotes-column").val());
				let row = parseInt($("#drop-quotes-row").val());
				dropQuotesColumnArea = [];
				for(let i = 0; i < col; i++) {
					dropQuotesColumnArea.push([]);
				}
				for(let i = 0; i < row; i++) {
					dropQuotesrowArea.push([]);
				}
				$("#drop-quotes-upper-bar").empty();
				$("#dq-board").empty();

				for(let i = 0; i < col; i++) {
					$("#drop-quotes-upper-bar").append(`<div id="dq-col-${i}" class="col-container"></div>`);
					$(`#drop-quotes-upper-bar #dq-col-${i}`).append(`<div id="dq-col-cell-${i}-0" data-type="col" data-col=${i} data-idx=0 contenteditable="true" oninput="dropQuotesChangeInput(event)" class="col-input">0</div>`);
				}
				for(let i = 0; i < row; i++) {
					$("#dq-board").append(`<div id="row-${i}" class="row-board"></div>`);
					// $(`#board #row-${i}`).append(`<div contenteditable="true" class="row-input"></div>`);
					for(let j = 0; j < col; j++) {
						$(`#dq-board #row-${i}`).append(`<div id="dq-cell-${i}-${j}" class="cell" style="background: white"></div>`);
					}
				}
				$("#dq-board .cell").on("click",function(e) {
					console.info(e.target);
					if(e.target.style.backgroundColor === "white") {
						e.target.style.backgroundColor = "black";
					} else {
						e.target.style.backgroundColor = "white";
					}
				});
			}

			dropQuoteModifiedCb();

		</script>

		</div>
	</body>
</html>
